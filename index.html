<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to PDF</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .markdown-preview {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        .markdown-preview h1 {
            font-size: 2em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        .markdown-preview h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        .markdown-preview h3 {
            font-size: 1.25em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        .markdown-preview code {
            background-color: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 85%;
        }
        .markdown-preview pre {
            background-color: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow: auto;
            margin: 16px 0;
        }
        .markdown-preview pre code {
            background: none;
            padding: 0;
        }
        .markdown-preview blockquote {
            border-left: 4px solid #dfe2e5;
            padding-left: 16px;
            color: #6a737d;
            margin: 16px 0;
        }
        .markdown-preview a {
            color: #0366d6;
            text-decoration: none;
        }
        .markdown-preview a:hover {
            text-decoration: underline;
        }
        .markdown-preview ul, .markdown-preview ol {
            padding-left: 2em;
            margin: 16px 0;
        }
        .markdown-preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
        }
        .markdown-preview table th,
        .markdown-preview table td {
            border: 1px solid #dfe2e5;
            padding: 6px 13px;
        }
        .markdown-preview table th {
            background-color: #f6f8fa;
            font-weight: 600;
        }
        .markdown-preview img {
            max-width: 100%;
            height: auto;
        }
        .markdown-preview p {
            margin: 16px 0;
        }
        .markdown-preview strong {
            font-weight: 600;
        }
        .markdown-preview em {
            font-style: italic;
        }
        /* Force textarea to stay full height */
        #markdown-input {
            min-height: 100% !important;
            max-height: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-50">
  <!-- NAVBAR -->
  <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <h1 class="text-xl md:text-2xl font-bold text-gray-900">
            Markdown to PDF
          </h1>
        </div>
        <div class="flex items-center gap-2">
          <span id="stats" class="text-sm text-gray-600 hidden md:block"></span>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="h-[calc(100vh-64px)] max-w-full px-4 py-4">
    <div class="h-full grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- EDITOR PANEL -->
      <div class="h-full bg-white rounded-lg shadow-lg overflow-hidden flex flex-col">
        <div class="bg-gray-50 border-b border-gray-200 px-4 py-3 flex items-center justify-between flex-shrink-0">
          <h2 class="text-lg font-semibold text-gray-700">Editor</h2>
          <button onclick="clearEditor()" class="text-sm text-red-600 hover:text-red-700 font-medium">
            Clear
          </button>
        </div>
        <div class="flex-1 p-4 overflow-hidden">
          <textarea 
            id="markdown-input" 
            class="w-full h-full p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
            placeholder="# Start typing your markdown here...

```javascript
console.log('Hello, Markdown!');
```"
          ></textarea>
        </div>
      </div>


      <!-- PREVIEW PANEL -->
      <div class="h-full bg-white rounded-lg shadow-lg overflow-hidden flex flex-col">
        <div class="bg-gray-50 border-b border-gray-200 px-4 py-3 flex items-center justify-between flex-shrink-0">
          <h2 class="text-lg font-semibold text-gray-700">Preview</h2>
          <div class="flex gap-2">
            <button id="pdf-btn" onclick="downloadPdf()" class="text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
              <span id="pdf-text">PDF</span>
            </button>
          </div>
        </div>
        <div class="flex-1 p-6 overflow-y-auto">
          <div id="preview" class="markdown-preview"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const input = document.getElementById('markdown-input');
    const preview = document.getElementById('preview');
    const stats = document.getElementById('stats');
    const defaultMarkdown = `# Markdown Viewer
*halo*
**halo**
***halo***

## Code

\`\`\`javascript
function hey(name) {
  console.log(\`Halo, \${name}!\`);
}

hey('World');
\`\`\`

## Tabel

| Fitur | Status |
|---------|--------|
| Live Preview | Bener |

## Blockquote

> "Markfown Blockquete."`;

    input.value = defaultMarkdown;

    function updatePreview() {
        const markdown = input.value;
      
        marked.setOptions({
          breaks: true,
          gfm: true
         });
      
      const html = marked.parse(markdown);
        preview.innerHTML = html;
      
      const words = markdown.trim() ? markdown.trim().split(/\s+/).length : 0;
      const chars = markdown.length;
        stats.textContent = `${words} words â€¢ ${chars} characters`;
    }

      function clearEditor() {
        input.value = '';
          updatePreview();
      }

      

  function downloadPdf() {
    const btn = document.getElementById('pdf-btn');
    const btnText = document.getElementById('pdf-text');
    
    try {
      // Check if jsPDF is loaded
      if (!window.jspdf) {
        alert('PDF library belum ter-load. Coba refresh halaman.');
        return;
      }

      // Disable button and show loading
      btn.disabled = true;
      btnText.textContent = 'Loading...';

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const htmlContent = marked.parse(input.value);
      const tempElement = document.createElement('div');
      tempElement.innerHTML = htmlContent;
      tempElement.style.padding = '20px';
      tempElement.style.fontFamily = 'Arial, sans-serif';
      tempElement.style.lineHeight = '1.6';
      
      // Use setTimeout to prevent UI freeze
      setTimeout(() => {
        doc.html(tempElement, {
          callback: function (doc) {
            doc.save('markdown-document.pdf');
            // Re-enable button
            btn.disabled = false;
            btnText.textContent = 'PDF';
          },
          x: 10,
          y: 10,
          width: 180,
          windowWidth: 800
        });
      }, 100);
      
    } catch (error) {
      console.error('Error generating PDF:', error);
      alert('Error saat generate PDF: ' + error.message);
      // Re-enable button on error
      btn.disabled = false;
      btnText.textContent = 'PDF';
    }
  }


 input.addEventListener('input', updatePreview);
    



    input.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        e.preventDefault();
      const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);
     this.selectionStart = this.selectionEnd = start + 2;
      }
    });





    updatePreview();
  </script>
</body>
</html>